{% extends "base.html" %}

{% block content %}
<h2>{{ voting.title }}</h2>
<p>{{ voting.description }}</p>
<p>Автор: {{ voting.creator.login }} | Создано: {{ voting.created_at.strftime('%d.%m.%Y %H:%M') }}</p>

{% if voting.is_active and not user_voted and session.user_id %}
    <h3>Голосование</h3>
    <form method="POST" action="{{ url_for('vote', voting_id=voting.id) }}">
        {% for option in options %}
            <div>
                <label>
                    <input type="radio" name="option" value="{{ loop.index0 }}" required>
                    {{ option }}
                </label>
            </div>
        {% endfor %}
        <button type="submit">Проголосовать</button>
    </form>
{% elif user_voted %}
    <p>Вы уже проголосовали в этом опросе.</p>
{% elif not session.user_id %}
    <p><a href="{{ url_for('login') }}">Войдите</a>, чтобы голосовать.</p>
{% endif %}

<h3>Результаты (всего голосов: {{ total_votes }})</h3>
{% for option, result in results.items() %}
    <div>
        <div>{{ option }} - {{ result.votes }} голосов ({{ result.percentage }}%)</div>
        <div class="progress">
            <div class="progress-bar" style="width: {{ result.percentage }}%;">{{ result.percentage }}%</div>
        </div>
    </div>
{% endfor %}
{% endblock %}